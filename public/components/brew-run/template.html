<div class="container-fluid" data-bind="if: brew">
    <div class="page-header">
        <h1>Brewing <span data-bind="text: brew().name"></span> <small data-bind="text: brew().description"></small></h1>
    </div>
    <div class="row">
        <div class="col-md-7">
            <table class="table table-condensed table-striped">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Step</th>
                        <th>Actions</th>
                        <th>Finish criteria</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: steps">
                    <tr data-bind="css: { 'text-muted': $parent.brew().step > $index(), success: $parent.brew().step > $index(), active: $parent.brew().step === $index(), warning: $parent.brew().step < $index() }">
                        <td data-bind="text: $index"></td>
                        <td data-bind="text: name"></td>
                        <td>
                            <ul data-bind="foreach: actions">
                                <li>
                                    <!-- ko if: type === 'SetTemperature' -->
                                        Setting temperature of <span data-bind="text: input"></span> to <span data-bind="text: temperature"></span> degrees
                                    <!-- /ko -->

                                    <!-- ko if: type === 'SetPins' -->
                                        Activating <span data-bind="text: outputs.join()"></span>
                                    <!-- /ko -->

                                    <!-- ko if: type === 'SetTimer' -->
                                        Setting <span data-bind="text: timer"></span> to <span data-bind="text: timeout"></span> minutes
                                    <!-- /ko -->
                                </li>
                            </ul>
                        </td>
                        <td>
                            <ul data-bind="foreach: criteria">
                                <li>
                                    <!-- ko if: type === 'AwaitUser' -->
                                        <span data-bind="visible: !$data.fullfilled">
                                            Awaiting user confirmation <button class="btn btn-success btn-xs" data-bind="click: $parents[1].userOkay, visible: $parents[1].brew().step === $parentContext.$index()">Okay</button>
                                        </span>
                                        <span data-bind="visible: $data.fullfilled">
                                            User has confirmed
                                        </span>
                                    <!-- /ko -->

                                    <!-- ko if: type === 'AwaitTemperature' -->
                                        <span data-bind="visible: !$data.fullfilled">
                                            <span data-bind="text: input"></span> must be <span data-bind="text: temperature"></span> degrees
                                        </span>
                                        <span data-bind="visible: $data.fullfilled">
                                            <span data-bind="text: input"></span> has reached <span data-bind="text: temperature"></span> degrees
                                        </span>
                                    <!-- /ko -->

                                    <!-- ko if: type === 'AwaitTimer' -->
                                        <span data-bind="visible: !$data.fullfilled">
                                            <span data-bind="text: timer"></span> must expire
                                        </span>
                                        <span data-bind="visible: $data.fullfilled">
                                            <span data-bind="text: timer"></span> has expired
                                        </span>
                                    <!-- /ko -->
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-5">
            <status></status>
        </div>
    </div>
</div>
